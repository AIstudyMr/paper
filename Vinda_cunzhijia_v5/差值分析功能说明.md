# 差值分析功能说明

## 🎯 功能概述

新增的差值分析功能可以计算任意两列数据在每个时间段内每分钟的差值，并统计正负差值的比例。这个功能基于已经处理过的列数据进行分析。

## 📁 文件结构

```
├── 数据分析处理.py          # 主脚本（包含差值分析功能）
├── 差值分析专用脚本.py      # 专用差值分析脚本
├── 差值分析结果/            # 差值分析结果文件夹
│   ├── [列名1]_减_[列名2]_详细数据.csv
│   └── [列名1]_减_[列名2]_统计汇总.csv
```

## 🔧 使用方法

### 方法1：使用专用脚本（推荐）

1. **修改列名**：在 `差值分析专用脚本.py` 中直接修改这两行：
   ```python
   COL1 = "折叠机入包数"      # 第一列名称
   COL2 = "折叠机出包数"      # 第二列名称
   ```

2. **运行脚本**：
   ```bash
   python 差值分析专用脚本.py
   ```

### 方法2：使用主脚本

运行主脚本后，系统会在图表生成完成后提示您选择要分析的两列。

## 📊 输出结果

### 1. 详细数据文件
包含每个时间点的具体数值：
- 时间段
- 时间点
- 第一列数值
- 第二列数值
- 差值（第一列 - 第二列）
- 差值符号（正/负/零）

### 2. 统计汇总文件
包含每个时间段的统计信息：
- 时间段标识
- 总数据点数
- 正差值数量/比例
- 负差值数量/比例
- 零差值数量/比例
- 平均差值
- 差值标准差
- 最大差值
- 最小差值

### 3. 控制台输出
显示每个时间段的实时统计和最终汇总结果。

## 📋 可用列名

以下列名可用于差值分析：
1. 折叠机实际速度
2. 折叠机入包数
3. 折叠机出包数
4. 外循环进内循环纸条数量
5. 存纸率
6. 裁切机实际速度
7. 有效总切数
8. 1#有效切数
9. 2#有效切数
10. 3#有效切数
11. 4#有效切数
12. 进第一裁切通道纸条计数
13. 进第二裁切通道纸条计数
14. 进第三裁切通道纸条计数
15. 进第四裁切通道纸条计数
16. 1#小包机入包数
17. 1#小包机实际速度
18. 2#小包机入包数
19. 2#小包机实际速度
20. 3#小包机入包数
21. 3#小包机主机实际速度
22. 4#小包机入包数
23. 4#小包机主机实际速度
24. 小包机速度总和

## 📈 分析示例

### 示例：折叠机入包数 vs 折叠机出包数

**总体统计结果：**
- 总数据点：2,898 个
- 正差值：1,071 个 (36.96%) - 入包数 > 出包数
- 负差值：1,015 个 (35.02%) - 入包数 < 出包数  
- 零差值：812 个 (28.02%) - 入包数 = 出包数
- 平均差值：0.0132

**业务意义：**
- 约37%的时间入包数大于出包数（可能存在积压）
- 约35%的时间入包数小于出包数（正常流转）
- 约28%的时间入包数等于出包数（完美平衡）

## 🎛️ 技术细节

### 数据处理流程
1. **数据预处理**：使用 `process_data_for_time_period` 函数处理原始数据
2. **差值计算**：逐点计算两列数据的差值（COL1 - COL2）
3. **统计分析**：统计正差值、负差值、零差值的数量和比例
4. **结果保存**：生成详细数据和统计汇总两个CSV文件

### 时间段处理
- 每个时间段独立分析
- 每分钟一个数据点
- 自动处理数据长度不一致的情况
- 跳过无效或空的时间段

### 输出格式
- 使用UTF-8-SIG编码，支持中文显示
- CSV格式便于Excel打开和进一步分析
- 文件名包含分析的列名，便于识别

## 💡 应用场景

1. **设备同步性分析**：比较不同设备的运行效率
2. **流程平衡分析**：分析生产流程中的瓶颈
3. **质量控制**：监控关键指标的一致性
4. **趋势分析**：观察两个指标的相对变化趋势
5. **异常检测**：识别差值异常的时间段

## ⚠️ 注意事项

1. 确保选择的列名在数据中存在
2. 差值分析基于已处理的分钟级数据
3. 累积量数据已经过差值处理和标准化
4. 建议选择业务相关的列进行有意义的比较分析 