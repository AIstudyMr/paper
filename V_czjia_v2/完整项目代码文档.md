# 维达纸业存纸架数据分析项目完整代码文档

## 项目概述

本项目是对维达纸业存纸架系统的全面数据分析项目，包含裁切机速度分析、小包机启停事件分析、尾架影响分析等多个子模块。项目通过Python数据分析技术，对2025年4月30日至5月6日期间的生产数据进行了深入分析。

### 项目结构

```
Vinda_cunzhijia_v2/
├── 存纸架数据汇总.csv (172MB - 主数据文件)
├── README_裁切机速度分析.md (项目说明文档)
├── .cursorignore (忽略文件配置)
│
├── 核心分析脚本/
│   ├── analyze_speed_transitions.py (小包机启停分析)
│   ├── advanced_daily_cutting_analysis.py (高级裁切分析)
│   ├── simple_daily_speed_curves.py (简洁版速度曲线)
│   ├── draw_daily_cutting_speed_curves.py (基础速度曲线)
│   ├── analyze_tailstock_impact.py (尾架影响分析)
│   ├── analyze_stops.py (停机概率分析)
│   ├── plot_cuts_and_strips.py (裁切和条带图)
│   └── 其他分析脚本...
│
├── 辅助脚本/
│   ├── check_data_structure.py (数据结构检查)
│   ├── check_time_range.py (时间范围检查)
│   ├── check_columns.py (列名检查)
│   └── rename_columns.py (列名重命名)
│
└── 分析结果目录/
    ├── 简洁版每日速度曲线/
    ├── 高级裁切机速度分析/
    ├── 每日裁切机速度曲线图/
    ├── 小包机概率计算/
    ├── 尾架分析结果/
    ├── 1-4号小包机启停分析结果/
    └── 速度曲线分析/
```

## 1. 项目说明文档

### README_裁切机速度分析.md

项目的核心说明文档，包含了完整的分析报告和技术参数定义。文档涵盖：

- **数据概览**: 494,149个数据点，7天分析周期
- **生成结果**: 基础速度曲线、高级分析图表、简洁版曲线
- **关键发现**: 每日运行质量评分，5月4日表现最佳
- **技术参数**: 稳定运行标准、异常检测方法
- **使用指南**: 脚本运行方法和技术栈说明

## 2. 核心分析脚本

### 2.1 小包机启停分析 (analyze_speed_transitions.py)

**功能**: 分析四台小包机的启停事件，识别不同状态转换

**核心算法**:
- 速度阈值定义: 停止(0-24)、待机(25-50)、正常生产(≥51)
- 滑动窗口分析: 20点窗口，斜率阈值0.1
- 事件类型: 6种状态转换模式

**关键代码片段**:
```python
def analyze_speed_transitions(df, window_size=20, slope_threshold=0.1):
    results = {
        "停止到待机": [],
        "停止到正常生产": [],
        "正常生产到停止": [], 
        "正常生产到待机": [],
        "待机到正常生产": [],
        "待机到停止": []
    }
    # 核心分析逻辑...
```

### 2.2 高级裁切分析 (advanced_daily_cutting_analysis.py)

**功能**: 生成每日详细分析图表和运行质量仪表板

**分析维度**:
1. **速度曲线与异常检测**: 基于Z-score的异常点识别
2. **速度分布直方图**: 显示速度分布模式
3. **滑动平均趋势**: 1分钟、5分钟、15分钟滑动平均
4. **速度变化率**: 反映速度变化剧烈程度

**关键功能**:
```python
def detect_anomalies(speed_data, threshold=2):
    """检测异常值（基于Z-score）"""
    z_scores = np.abs(stats.zscore(speed_data))
    anomalies = z_scores > threshold
    return anomalies

def create_summary_dashboard(all_reports, output_dir):
    """创建总结仪表板"""
    # 6个子图的综合分析仪表板
    # 包含趋势、稳定率、异常点、波动范围等
```

### 2.3 简洁版速度曲线 (simple_daily_speed_curves.py)

**功能**: 生成美观简洁的每日速度曲线和周总结

**特色功能**:
- 填充区域突出显示
- 统计信息框显示
- 周总结对比分析
- 稳定率计算和显示

**美化设计**:
```python
plt.style.use('seaborn-v0_8')
ax.fill_between(df_day['时间'], df_day['裁切机实际速度'], 
                alpha=0.3, color='#1f77b4')
# 统计信息框
stats_box = f"""统计信息
━━━━━━━━━━━━━━━━━━━━━━━━━━
• 数据点数: {len(df_day):,}
• 平均速度: {df_day['裁切机实际速度'].mean():.2f}
• 稳定率: {稳定率:.1f}%"""
```

### 2.4 尾架影响分析 (analyze_tailstock_impact.py)

**功能**: 分析尾架原纸剩余量对生产性能的影响

**分析内容**:
1. **尾架剩余米数与折叠机速度关系**: 散点图+趋势线+相关系数
2. **区间分析**: 将剩余量分5个区间，分析对存纸率的影响
3. **小包机速度关系**: 尾架状态对各小包机速度的影响
4. **临界值分析**: 剩余量低于100米时的影响

**核心分析**:
```python
def analyze_critical_values(df, threshold=100):
    """分析原纸剩余量低于阈值时的影响"""
    for col in tailstock_columns:
        low_remaining = df[df[col] <= threshold]
        high_remaining = df[df[col] > threshold]
        # 对比分析低于和高于阈值的运行状况
```

### 2.5 停机概率分析 (analyze_stops.py)

**功能**: 计算各小包机的停机概率和持续时间分析

**分析指标**:
- 停机概率（连续超过10秒）
- 平均停机时长
- 最长停机时长
- 每日停机统计
- 全周期vs最近24小时对比

**核心算法**:
```python
def calculate_stop_probability(df, machine_number, time_window=None):
    # 识别停机状态（速度为0）
    df['is_stopped'] = df[speed_col] == 0
    # 创建停机组
    df['stop_group'] = (df['is_stopped'] != df['is_stopped'].shift()).cumsum()
    # 计算停机概率
    stop_probability = total_long_stop_time / total_time
```

## 3. 辅助脚本工具

### 3.1 数据检查脚本

**check_data_structure.py**: 查看CSV文件结构和数据类型
**check_time_range.py**: 检查时间范围和基本统计
**check_columns.py**: 查看所有列名
**rename_columns.py**: 重新映射列名（修正数据标签错误）

### 3.2 配置文件

**.cursorignore**: 忽略大文件格式（xlsx, pdf等）

## 4. 数据分析结果

### 4.1 关键发现总结

| 指标 | 数值 | 说明 |
|------|------|------|
| 数据总量 | 494,149点 | 7天连续监控 |
| 平均每日数据 | 70,592点 | 约每秒1个数据点 |
| 最佳运行日 | 2025-05-04 | 平均速度112.4，稳定率98.3% |
| 需关注日期 | 2025-05-02 | 异常点4762个，稳定率94.3% |
| 整体稳定率 | >95% | 大部分时间稳定运行 |

### 4.2 生成图表类型

1. **每日速度曲线图** (7个每日图 + 1个总览图)
2. **高级分析图** (7个四维分析图 + 1个仪表板)
3. **简洁版曲线** (7个美化图 + 1个周总结)
4. **启停分析** (4台机器 × 6种事件类型)
5. **尾架影响图** (相关性分析 + 区间影响图)
6. **停机概率图** (概率计算 + 时间分析)

### 4.3 输出文件格式

- **PNG图片**: 高分辨率(300dpi)分析图表
- **CSV报告**: 详细数值统计和每日报告
- **分类存储**: 按分析类型分目录保存

## 5. 技术栈和依赖

### 5.1 核心库
```python
import pandas as pd          # 数据处理和分析
import matplotlib.pyplot as plt  # 图表绘制
import numpy as np          # 数值计算
import scipy.stats          # 统计分析和异常检测
import seaborn as sns       # 图表美化
```

### 5.2 关键技术

- **异常检测**: Z-score方法，阈值2个标准差
- **滑动平均**: 多窗口分析(1分钟、5分钟、15分钟)
- **状态识别**: 基于速度阈值的机器状态分类
- **概率计算**: 停机事件的时间序列分析
- **相关性分析**: 多变量关系的统计分析

## 6. 项目运行指南

### 6.1 环境要求
```bash
Python 3.7+
pandas >= 1.3.0
matplotlib >= 3.3.0
numpy >= 1.20.0
scipy >= 1.7.0
seaborn >= 0.11.0
```

### 6.2 运行顺序
1. **数据检查**: 先运行check_*脚本验证数据
2. **基础分析**: 运行draw_daily_cutting_speed_curves.py
3. **高级分析**: 运行advanced_daily_cutting_analysis.py
4. **专项分析**: 根据需要运行其他专项分析脚本

### 6.3 输出目录
- 所有结果自动按类型分目录保存
- 图片格式: PNG (300dpi)
- 数据格式: CSV (UTF-8编码)

## 7. 项目价值和应用

### 7.1 业务价值
- **生产监控**: 实时掌握设备运行状态
- **质量控制**: 识别异常波动和稳定性问题  
- **预防维护**: 基于数据的设备维护决策
- **效率优化**: 分析最佳运行参数和时段

### 7.2 技术创新
- **多维度分析**: 集成速度、切数、尾架等多个指标
- **自动化报告**: 一键生成全套分析图表
- **智能异常检测**: 基于统计学的异常识别
- **可视化仪表板**: 直观的运行质量评估

### 7.3 扩展可能
- **实时监控系统**: 集成到生产监控平台
- **预测性维护**: 基于历史数据预测设备故障
- **自动化告警**: 异常情况的实时通知
- **移动端支持**: 开发移动App进行远程监控

---

**项目作者**: 数据分析团队  
**最后更新**: 2025年5月6日  
**文档版本**: v1.0  
**数据源**: 存纸架数据汇总.csv (172MB)  
**分析周期**: 2025-04-30 至 2025-05-06 (7天) 